# 提案：将静态资源嵌入二进制文件

**状态**: ✅ 已实施并归档准备中

## Why

### 问题
当前 Web UI 的静态文件（HTML/CSS/JS）以外部文件形式存在于 `pkg/web/static/` 目录中。这导致：

1. **部署复杂性**：用户需要确保静态文件与二进制文件一起分发，否则 Web UI 无法正常工作
2. **文件完整性风险**：静态文件可能被意外删除、修改或损坏
3. **版本不一致**：二进制文件与静态文件版本可能不匹配，导致兼容性问题
4. **分发体验差**：需要打包和解压多个文件，而不是单一可执行文件

### 目标
使用 Go 1.16+ 的 `embed` 包将静态资源在编译时打包进二进制文件，实现：

1. **单文件分发**：用户只需下载一个二进制文件即可运行完整功能
2. **零依赖部署**：无需关心静态文件的存在性和路径
3. **版本一致性**：静态资源与代码版本完全绑定
4. **简化部署**：开箱即用，降低使用门槛

## What Changes

### 受影响的组件
- `pkg/web/server.go`：修改静态文件服务逻辑，使用嵌入的文件系统
- `pkg/web/static/`：静态资源目录保持不变，作为嵌入源
- 构建流程：无需额外配置，Go 编译器自动处理

### 技术方案
1. 使用 `//go:embed` 指令将 `pkg/web/static` 目录嵌入到 Go 程序中
2. 使用 `embed.FS` 创建嵌入的文件系统
3. 修改 Gin 路由配置，使用 `http.FS` 适配器提供静态文件服务
4. 保持 API 和行为不变，对用户透明

### 向后兼容性
- ✅ **完全兼容**：不改变任何 CLI 参数、API 接口或行为
- ✅ **透明升级**：用户无需修改任何配置或使用方式
- ✅ **开发体验**：静态文件仍可正常编辑，编译后自动嵌入

## Specs

变更涉及以下规格：

- `build-system`：编译流程保持不变，Go 编译器自动处理嵌入
- `web-api`：静态文件服务方式改变，但 API 行为不变

## Risks

### 技术风险
- **低风险**：`embed` 是 Go 标准库功能，稳定可靠
- **文件大小**：静态文件会增加二进制文件体积（当前约 10-20KB，可忽略）

### 缓解措施
- 保持静态文件精简，避免嵌入大型资源
- 测试验证嵌入后的文件服务功能完整性

## Implementation Notes

### 开发流程
1. 开发时修改静态文件后，重新编译即可更新
2. 无需运行额外的资源打包工具
3. CI/CD 流程无需修改

### 测试策略
1. 单元测试：验证嵌入文件系统可用性
2. 集成测试：验证 Web UI 正常加载和功能
3. 手动测试：确认不同平台的二进制文件独立运行

## Alternatives Considered

### 方案 1：外部静态文件（当前方案）
- ❌ 部署复杂，需要管理多个文件
- ❌ 用户体验差

### 方案 2：使用第三方打包工具（如 go-bindata）
- ❌ 引入额外依赖
- ❌ 需要额外的构建步骤
- ✅ Go 1.16+ 的 `embed` 包已是标准解决方案

### 方案 3：静态资源 CDN
- ❌ 依赖网络连接
- ❌ 增加部署复杂度
- ❌ 不适合离线或内网环境

## References

- Go embed 文档：https://pkg.go.dev/embed
- Gin 静态文件服务：https://gin-gonic.com/docs/examples/serving-static-files/
